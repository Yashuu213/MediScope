<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications | MediScope</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="script.js" defer></script>
</head>
<body class="bg-gray-50">
    <!-- Same header as index.html -->
    <header class="bg-blue-600 text-white shadow-md">
        <!-- Include header from index.html -->
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Notifications</h2>
            <button onclick="window.history.back()" class="flex items-center text-blue-600 hover:text-blue-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                </svg>
                Back
            </button>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="border-b px-4 py-3 flex justify-between items-center bg-gray-50">
                <h3 class="font-medium">Recent Alerts</h3>
                <button id="markAllRead" class="text-sm text-blue-600 hover:text-blue-800">Mark all as read</button>
            </div>
            
            <div id="notificationsList" class="divide-y divide-gray-200">
                <!-- Notifications will be loaded here -->
            </div>
            
            <div id="noNotifications" class="text-center py-12 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
                <p class="mt-2 text-gray-500">No notifications to display</p>
            </div>
        </div>
    </main>

    <script>
        // Check authentication
        document.addEventListener('DOMContentLoaded', () => {
            const storedUser = localStorage.getItem('currentUser');
            if (!storedUser) {
                window.location.href = 'index.html';
                return;
            }
            
            const user = JSON.parse(storedUser);
            initNotificationsPage(user);
        });

        function initNotificationsPage(user) {
            const notificationsList = document.getElementById('notificationsList');
            const noNotifications = document.getElementById('noNotifications');
            const markAllRead = document.getElementById('markAllRead');
            
            // Load notifications
            const notifications = JSON.parse(localStorage.getItem('healthPortalNotifications')) || [];
            const userNotifications = notifications.filter(n => n.userId === user.id);
            
            if (userNotifications.length === 0) {
                noNotifications.classList.remove('hidden');
                notificationsList.classList.add('hidden');
            } else {
                noNotifications.classList.add('hidden');
                notificationsList.classList.remove('hidden');
                
                // Sort by date (newest first)
                userNotifications.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Display notifications
                userNotifications.forEach(notification => {
                    const notificationEl = document.createElement('div');
                    notificationEl.className = `px-4 py-3 ${notification.seen ? 'bg-white' : 'bg-blue-50'}`;
                    notificationEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-medium ${notification.seen ? 'text-gray-800' : 'text-blue-800'}">${notification.title}</h4>
                                <p class="text-sm ${notification.seen ? 'text-gray-600' : 'text-blue-600'}">${notification.message}</p>
                                <p class="text-xs text-gray-400 mt-1">${formatDate(notification.date)}</p>
                            </div>
                            ${!notification.seen ? '<span class="h-2 w-2 rounded-full bg-blue-500"></span>' : ''}
                        </div>
                    `;
                    
                    // Mark as read when clicked
                    notificationEl.addEventListener('click', () => {
                        if (!notification.seen) {
                            notification.seen = true;
                            localStorage.setItem('healthPortalNotifications', JSON.stringify(notifications));
                            notificationEl.className = 'px-4 py-3 bg-white';
                            notificationEl.querySelector('h4').className = 'font-medium text-gray-800';
                            notificationEl.querySelector('p').className = 'text-sm text-gray-600';
                            notificationEl.querySelector('div > div').lastElementChild.remove();
                        }
                    });
                    
                    notificationsList.appendChild(notificationEl);
                });
            }
            
            // Mark all as read
            markAllRead.addEventListener('click', () => {
                const notifications = JSON.parse(localStorage.getItem('healthPortalNotifications')) || [];
                const updated = notifications.map(n => {
                    if (n.userId === user.id && !n.seen) {
                        return {...n, seen: true};
                    }
                    return n;
                });
                
                localStorage.setItem('healthPortalNotifications', JSON.stringify(updated));
                
                // Update UI
                document.querySelectorAll('#notificationsList > div').forEach(el => {
                    if (el.classList.contains('bg-blue-50')) {
                        el.className = 'px-4 py-3 bg-white';
                        el.querySelector('h4').className = 'font-medium text-gray-800';
                        el.querySelector('p').className = 'text-sm text-gray-600';
                        const unreadDot = el.querySelector('span');
                        if (unreadDot) unreadDot.remove();
                    }
                });
            });
            
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }
        
    </script>
</body>
</html>
